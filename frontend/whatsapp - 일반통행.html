<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KIVOSY ì™“ì¸ ì•± ì»¨íŠ¸ë¡¤ëŸ¬</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #1a1a1e; color: white; }
        textarea { width: 100%; height: 120px; background: #2d2d32; color: white; border: 1px solid #444; border-radius: 10px; padding: 10px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; margin-top: 10px; background: #25D366; border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer; }
        #response-area { margin-top: 20px; padding: 15px; background: #25252b; border-radius: 10px; border-left: 5px solid #25D366; display: none; }
        .thinking { color: #888; font-style: italic; font-size: 0.9em; margin-bottom: 10px; }
        .answer { color: #fff; line-height: 1.5; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h2>ğŸŸ¢ 14B ê³¼ì¥ë‹˜ ì–‘ë°©í–¥ ì±„ë„</h2>
    <textarea id="msg" placeholder="ëª…ë ¹ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: Dë“œë¼ì´ë¸Œì— íŒŒì¼ ë§Œë“¤ì–´)"></textarea>
    <button onclick="send()">ì „ì†¡ ë° ê²°ê³¼ í™•ì¸</button>

    <div id="response-area">
        <div class="thinking" id="ai-thinking"></div>
        <div class="answer" id="ai-answer"></div>
    </div>

    <script>
        async function send() {
            const btn = document.querySelector('button');
            const msgField = document.getElementById('msg');
            const respArea = document.getElementById('response-area');
            const thinkingField = document.getElementById('ai-thinking');
            const answerField = document.getElementById('ai-answer');
            const content = msgField.value;

            if(!content) return alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”!");

            btn.disabled = true;
            btn.innerText = "â³ 14B ê³¼ì¥ì´ ìƒê° ì¤‘...";
            respArea.style.display = "none";

            try {
                const res = await fetch('/api/whatsapp', { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        sender: 'ê³µì¥ì¥(WhatsApp)', 
                        content: content,
                        channel: 'whatsapp'
                    })
                });

                const data = await res.json(); // ì„œë²„ì—ì„œ ì¤€ ë‹µë³€(AI ì‘ë‹µ)ì„ ë°›ìŠµë‹ˆë‹¤!

                if(res.ok) {
                    respArea.style.display = "block";
                    // ìë¹„ìŠ¤ì˜ ì†ë§ˆìŒ(Thinking)ê³¼ ìµœì¢… ë‹µë³€ì„ í™”ë©´ì— ë¿Œë ¤ì¤ë‹ˆë‹¤.
                    thinkingField.innerText = "ğŸ’­ " + (data.thinking || "ì¶”ë¡  ì¤‘...");
                    answerField.innerText = "ğŸ¤– " + (data.summary || data.raw || "ë‹µë³€ì„ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
                    msgField.value = '';
                }
            } catch(e) {
                alert('âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨!');
            } finally {
                btn.disabled = false;
                btn.innerText = "ì „ì†¡í•˜ê¸°";
            }
        }
    </script>
</body>
</html>